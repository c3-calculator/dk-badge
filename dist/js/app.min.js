function disclosure(e,t="toggle"){const i=e.closest("[data-toggle-wrapper]")?e:false;if(!i)return;let r=i.getAttribute("aria-expanded");r=r=="true"?true:false;let o=i.closest("data-toggle-wrapper")||document;o.querySelectorAll(`[data-toggle-button]`).forEach((e=>{e.setAttribute("aria-expanded","false")}));o.querySelectorAll(`[data-toggle-content]`).forEach((e=>{e.setAttribute("data-expanded","false")}));if(t==="close")return;const s=i.getAttribute("aria-controls");const a=document.getElementById(s);i.setAttribute("aria-expanded",!r);a.setAttribute("data-expanded",!r)}class DKBadge{#factors={server_lifecycle:.023,server_bandwidth:125e3,france_server_efficiency:6.69e-8,international_server_efficiency:71e-13,france_electricity_carbon_intensity:.052,world_electricity_carbon_intensity:.357,europe_electricity_carbon_intensity:.2307,server_pue:1.69,network_lifecycle_impact:4.78e-9,wifi_consumption:413e-14,g4_consumption:111e-13,server_country_network_ratio:.55,viewing_country_network_ratio:.45,mobile_acv_emissions:84,desktop_acv_emissions:175,tablette_acv_emissions:75.9,mobile_lifespan:8869500,desktop_lifespan:13271400,tablette_lifespan:592200,mobile_power:.00285,desktop_power:.0294,tablette_power:.0294};constructor(e={}){let{style:t,render:i,pue:r}=Object.assign({style:"full",render:true,pue:1.69},e);this.node=document.querySelector("[data-dk-badge]");this.style=t;this.pue=r;this.render=i;this.totalSize=0;this.timeSpent=0;this.deviceType="desktop";this.ges=0;this.timeIntervalId=null}debug(){console.log(this)}render(){}getUserDevice(){const e=navigator.userAgent.toLowerCase();const t=/iphone|android/.test(e)?"Mobile":false;const i=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(e)?"Tablet":false;return t||i||"Desktop"}getStoredData(){let e=sessionStorage.getItem("dk-badge");if(e){e=JSON.parse(e);this.timeSpent=e.timeSpent;this.totalSize=e.totalSize}}storeData(){sessionStorage.setItem("dk-badge",JSON.stringify({timeSpent:this.timeSpent,totalSize:this.totalSize}))}calculate(e,t,i){const r=e/1e3;const o={france_server_proportion:.5,international_server_proportion:.5,wifi_proportion:.5,g4_proportion:.5,mobile_proportion:i==="Mobile"?1:0,desktop_proportion:i==="Desktop"?1:0,tablette_proportion:i==="Tablet"?1:0,audience_location_france:1,audience_location_europe:0,audience_location_international:0};const s={acv:r/this.#factors.server_bandwidth*(this.#factors.server_lifecycle/1e3),usage:(o.france_server_proportion*this.#factors.france_server_efficiency*this.#factors.france_electricity_carbon_intensity+o.international_server_proportion*this.#factors.international_server_efficiency*this.#factors.world_electricity_carbon_intensity)*this.#factors.server_pue*(r*1e3)};const a={acv:this.#factors.network_lifecycle_impact*r,usage:r*8e3*(this.#factors.wifi_consumption*o.wifi_proportion+this.#factors.g4_consumption*o.g4_proportion)*(this.#factors.server_country_network_ratio*(o.france_server_proportion*this.#factors.france_electricity_carbon_intensity+o.international_server_proportion*this.#factors.world_electricity_carbon_intensity)+this.#factors.viewing_country_network_ratio*(o.audience_location_france*this.#factors.france_electricity_carbon_intensity+o.audience_location_europe*this.#factors.europe_electricity_carbon_intensity+o.audience_location_international*this.#factors.world_electricity_carbon_intensity))};const n={acv:t*(this.#factors.mobile_acv_emissions*o.mobile_proportion/this.#factors.mobile_lifespan+this.#factors.desktop_acv_emissions*o.desktop_proportion/this.#factors.desktop_lifespan+this.#factors.tablette_acv_emissions*o.tablette_proportion/this.#factors.tablette_lifespan),usage:t/3600*(this.#factors.mobile_power*o.mobile_proportion+this.#factors.desktop_power*o.desktop_proportion+this.#factors.tablette_power*o.tablette_proportion)*(o.audience_location_france*this.#factors.france_electricity_carbon_intensity+o.audience_location_europe*this.#factors.europe_electricity_carbon_intensity+o.audience_location_international*this.#factors.world_electricity_carbon_intensity)};const c=(s.acv+s.usage+a.acv+a.usage+n.acv+n.usage)*1e3;return c}#updateElement(e,t){const i=this.node.querySelector(`[data-dk-badge-${e}]`);if(!i)return;i.innerHTML=t}update(e,t,i,r){var o=[{key:"CO2",value:e.toFixed(2)+"g CO2e"},{key:"time",value:i+" sec."},{key:"device",value:r},{key:"weight",value:(t/1e3).toFixed(2)+" Ko"}];o.forEach((e=>{this.#updateElement(e.key,e.value)}))}getResources(e=performance.getEntries()){if(!e)return;if(e.length!==0){e.forEach(((e,t)=>{if("transferSize"in e){this.totalSize=this.totalSize+e.transferSize}}))}this.ges=this.calculate(this.totalSize,this.timeSpent,this.deviceType);this.update(this.ges,this.totalSize,this.timeSpent,this.deviceType)}perfObserver(e,t,i){this.getResources(e.getEntries());if(i>0){console.warn(`${i} entries got dropped due to the buffer being full.`)}}updateInterval(){return setInterval((()=>{this.timeSpent+=1;this.storeData();if(this.timeSpent%5===0){this.getResources([])}else{this.#updateElement("time",this.timeSpent+" sec.")}}),1e3)}handleVisibilityChange(){if(document.hidden){clearInterval(this.updateIntervalId);this.updateIntervalId=null}else{this.updateIntervalId=this.updateIntervalId||this.updateInterval()}}init(){const e=new PerformanceObserver((e=>{this.perfObserver.call(this,e)}));this.handleVisibilityChange();document.addEventListener("visibilitychange",(e=>{this.handleVisibilityChange.call(this,e)}),false);setTimeout((()=>{this.deviceType=this.getUserDevice();this.getStoredData();this.getResources();e.observe({entryTypes:["resource","navigation"]})}),500)}}document.addEventListener("click",(e=>{if(e.target.closest("[data-toggle-button]")){disclosure(e.target.closest("[data-toggle-button]"))}else if(!e.target.closest("[data-toggle-wrapper]")){const e=document.querySelectorAll(`[data-toggle-button]`);const t=document.querySelectorAll(`[data-toggle-content]`);if(e){e.forEach((e=>{e.setAttribute("aria-expanded","false")}))}if(t){t.forEach((e=>{e.setAttribute("data-expanded","false")}))}}}));document.addEventListener("keydown",(e=>{const t=27;if(e.keyCode===t){disclosure(e.target,"close")}}));document.addEventListener("blur",(e=>{if(e.relatedTarget&&!e.relatedTarget.closest("[data-toggle-wrapper]")){disclosure(e.target,"close")}}),true);
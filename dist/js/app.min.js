class DKBadge{#factors={server_lifecycle:.023,server_bandwidth:125e3,france_server_efficiency:6.69e-8,international_server_efficiency:71e-13,france_electricity_carbon_intensity:.052,world_electricity_carbon_intensity:.357,europe_electricity_carbon_intensity:.2307,server_pue:1.69,network_lifecycle_impact:4.78e-9,wifi_consumption:413e-14,g4_consumption:111e-13,server_country_network_ratio:.55,viewing_country_network_ratio:.45,mobile_acv_emissions:84,desktop_acv_emissions:175,tablette_acv_emissions:75.9,mobile_lifespan:8869500,desktop_lifespan:13271400,tablette_lifespan:592200,mobile_power:.00285,desktop_power:.0294,tablette_power:.0294};constructor(t={}){let{style:e,renderUI:i,pue:s,audienceLocationProportion:n,serverLocationProportion:a}=Object.assign({style:"full",renderUI:true,pue:1.69,audienceLocationProportion:{france:1,europe:0,international:0},serverLocationProportion:{france:.5,international:.5}},t);this.node=document.querySelector("[data-dk-badge]");this.style=e;this.pue=s;this.audienceLocationProportion=n;this.serverLocationProportion=a;this.renderUI=i;this.labels={intro:"This website has a carbon footprint of",emitted:"emitted",details:"Details",weight:"Weight",time:"Time",device:"Device",unknown:"unknown",CO2unit:"g CO2e",weightUnit:"Ko",timeUnit:"sec.",privacy:"no data is collected",...t.labels};this.weight=0;this.timeSpent=0;this.deviceType="desktop";this.ges=0;this.updateIntervalId=null;this.events={calculated:new CustomEvent("dkBadge:calculated",{detail:this}),updated:new CustomEvent("dkBadge:updated",{detail:this})}}render(){if(!this.renderUI)return;if(!this.node)return;const t=`\n\t\t\t<div class="dk-badge is-${this.style}">\n\t\t\t\t<p class="dk-badge_title">\n\t\t\t\t\t<span>${this.labels.intro}</span>\n\t\t\t\t\t<span class="dk-badge_co2" data-dk-badge-CO2>${this.labels.unknown}</span>\n\t\t\t\t\t<span class="dk-badge_co2_unit">${this.labels.emitted}</span>\n\t\t\t\t</p>\n\t\t\t\t<button class="dk-badge_button" aria-controls="dk-badge" aria-expanded="false" data-dk-badge-button>\n\t\t\t\t\t<svg xmlns='http://www.w3.org/2000/svg' viewBox="-2 -2 20 20" fill='none' stroke='currentColor' stroke-linecap='round' stroke-width='2'>\n\t\t\t\t\t\t<path d="M-2 8h20" class="h"/>\n\t\t\t\t\t\t<path d="M-2 8h20" class="v"/>\n\t\t\t\t\t\t<path d="M16 4L8 12L0 4" class="c"/> \n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class="sr-only">${this.labels.details}</span>\n\t\t\t\t</button>\n\t\t\t\t<div class="dk-badge_content" data-dk-badge-content id="dk-badge">\n\t\t\t\t\t<hr class="dk-badge_hr" role="presentation">\n\t\t\t\t\t<p class="dk-badge_data">${this.labels.weight}&nbsp;:&nbsp;<strong data-dk-badge-weight>${this.labels.unknown}</strong></p>\n\t\t\t\t\t<p class="dk-badge_data">${this.labels.time}&nbsp;:&nbsp;<strong data-dk-badge-time>${this.labels.unknown}</strong></p>\n\t\t\t\t\t<p class="dk-badge_data">${this.labels.device}&nbsp;:&nbsp;<strong data-dk-badge-device>${this.labels.unknown}</strong></p>\n\t\t\t\t\t<hr class="dk-badge_hr" role="presentation">\n\t\t\t\t\t<p class="dk-badge_data">Powered by DK <span class="is-small">${this.labels.privacy}</span></p>\n\t\t\t\t</div>\n\t\t\t</div>`;this.node.innerHTML=t}getUserDevice(){const t=navigator.userAgent.toLowerCase();const e=/iphone|android/.test(t)?"Mobile":false;const i=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(t)?"Tablet":false;return e||i||"Desktop"}getStoredData(){let t=sessionStorage.getItem("dk-badge");if(t){t=JSON.parse(t);this.timeSpent=t.timeSpent;this.weight=t.weight}}storeData(){sessionStorage.setItem("dk-badge",JSON.stringify({timeSpent:this.timeSpent,weight:this.weight}))}calculate(t,e,i){const s=t/1e3;const n={wifi_proportion:.5,g4_proportion:.5,mobile_proportion:i==="Mobile"?1:0,desktop_proportion:i==="Desktop"?1:0,tablette_proportion:i==="Tablet"?1:0};const a={acv:s/this.#factors.server_bandwidth*(this.#factors.server_lifecycle/1e3),usage:(this.serverLocationProportion.france*this.#factors.france_server_efficiency*this.#factors.france_electricity_carbon_intensity+this.serverLocationProportion.international*this.#factors.international_server_efficiency*this.#factors.world_electricity_carbon_intensity)*this.pue*(s*1e3)};const o={acv:this.#factors.network_lifecycle_impact*s,usage:s*8e3*(this.#factors.wifi_consumption*n.wifi_proportion+this.#factors.g4_consumption*n.g4_proportion)*(this.#factors.server_country_network_ratio*(this.serverLocationProportion.france*this.#factors.france_electricity_carbon_intensity+this.serverLocationProportion.international*this.#factors.world_electricity_carbon_intensity)+this.#factors.viewing_country_network_ratio*(this.audienceLocationProportion.france*this.#factors.france_electricity_carbon_intensity+this.audienceLocationProportion.europe*this.#factors.europe_electricity_carbon_intensity+this.audienceLocationProportion.international*this.#factors.world_electricity_carbon_intensity))};const r={acv:e*(this.#factors.mobile_acv_emissions*n.mobile_proportion/this.#factors.mobile_lifespan+this.#factors.desktop_acv_emissions*n.desktop_proportion/this.#factors.desktop_lifespan+this.#factors.tablette_acv_emissions*n.tablette_proportion/this.#factors.tablette_lifespan),usage:e/3600*(this.#factors.mobile_power*n.mobile_proportion+this.#factors.desktop_power*n.desktop_proportion+this.#factors.tablette_power*n.tablette_proportion)*(this.audienceLocationProportion.france*this.#factors.france_electricity_carbon_intensity+this.audienceLocationProportion.europe*this.#factors.europe_electricity_carbon_intensity+this.audienceLocationProportion.international*this.#factors.world_electricity_carbon_intensity)};const c=(a.acv+a.usage+o.acv+o.usage+r.acv+r.usage)*1e3;this.ges=c;document.dispatchEvent(this.events.calculated)}#updateElement(t,e){if(!this.renderUI)return;const i=this.node.querySelector(`[data-dk-badge-${t}]`);if(!i)return;i.innerHTML=e}update(){if(!this.renderUI)return;var t=[{key:"CO2",value:this.ges.toFixed(2)+" "+this.labels.CO2unit},{key:"time",value:this.timeSpent+" "+this.labels.timeUnit},{key:"device",value:this.deviceType},{key:"weight",value:(this.weight/1e3).toFixed(2)+" "+this.labels.weightUnit}];t.forEach((t=>{this.#updateElement(t.key,t.value)}));document.dispatchEvent(this.events.updated)}getResources(t=performance.getEntries()){if(!t)return;if(t.length!==0){t.forEach(((t,e)=>{if("transferSize"in t){this.weight=this.weight+t.transferSize}}))}this.calculate(this.weight,this.timeSpent,this.deviceType)}perfObserver(t){this.getResources(t.getEntries())}updateInterval(){return setInterval((()=>{this.timeSpent+=1;this.storeData();if(this.timeSpent%5===0){this.getResources([])}else{this.#updateElement("time",this.timeSpent+" "+this.labels.timeUnit)}}),1e3)}handleVisibilityChange(){if(document.hidden){clearInterval(this.updateIntervalId);this.updateIntervalId=null}else{this.updateIntervalId=this.updateIntervalId||this.updateInterval()}}disclosure(t,e="toggle"){let i=t.getAttribute("aria-expanded");i=i=="true"?true:false;const s=e==="toggle"?!i:false;const n=t.getAttribute("aria-controls");const a=document.getElementById(n);t.setAttribute("aria-expanded",s);a.setAttribute("data-expanded",s);if(s===true&&this.style==="footer"){window.scrollBy(0,a.getBoundingClientRect().height+16)}}disclosureInit(){const t=this.node.querySelector("[data-dk-badge-button]");if(!t)return;document.addEventListener("click",(e=>{if(e.target.closest("[data-dk-badge-button]")){this.disclosure(t)}else if(!e.target.closest("[data-dk-badge]")){this.disclosure(t,"close")}}));document.addEventListener("keydown",(e=>{const i=27;if(e.keyCode===i){this.disclosure(t,"close")}}));document.addEventListener("blur",(e=>{if(e.relatedTarget&&!e.relatedTarget.closest("[data-dk-badge]")){this.disclosure(t,"close")}}),true)}init(){this.render();const t=new PerformanceObserver((t=>{this.perfObserver.call(this,t)}));this.disclosureInit();this.handleVisibilityChange();document.addEventListener("visibilitychange",(t=>{this.handleVisibilityChange.call(this,t)}),false);document.addEventListener("dkBadge:calculated",(t=>{this.update.call(this,t)}));setTimeout((()=>{this.deviceType=this.getUserDevice();this.getStoredData();this.getResources();t.observe({entryTypes:["resource","navigation"]})}),500)}}
function disclosure(t,e="toggle"){const i=t.closest("[data-toggle-wrapper]")?t:false;if(!i)return;let s=i.getAttribute("aria-expanded");s=s=="true"?true:false;let a=i.closest("data-toggle-wrapper")||document;a.querySelectorAll(`[data-toggle-button]`).forEach((t=>{t.setAttribute("aria-expanded","false")}));a.querySelectorAll(`[data-toggle-content]`).forEach((t=>{t.setAttribute("data-expanded","false")}));if(e==="close")return;const n=i.getAttribute("aria-controls");const o=document.getElementById(n);i.setAttribute("aria-expanded",!s);o.setAttribute("data-expanded",!s)}class DKBadge{#factors={server_lifecycle:.023,server_bandwidth:125e3,france_server_efficiency:6.69e-8,international_server_efficiency:71e-13,france_electricity_carbon_intensity:.052,world_electricity_carbon_intensity:.357,europe_electricity_carbon_intensity:.2307,server_pue:1.69,network_lifecycle_impact:4.78e-9,wifi_consumption:413e-14,g4_consumption:111e-13,server_country_network_ratio:.55,viewing_country_network_ratio:.45,mobile_acv_emissions:84,desktop_acv_emissions:175,tablette_acv_emissions:75.9,mobile_lifespan:8869500,desktop_lifespan:13271400,tablette_lifespan:592200,mobile_power:.00285,desktop_power:.0294,tablette_power:.0294};constructor(t={}){let{style:e,renderUI:i,pue:s,labels:a}=Object.assign({style:"full",renderUI:true,pue:1.69,labels:{intro:"This website has a carbon footprint of",details:"Details",weight:"Weight",time:"Time",device:"Device",unknown:"unknown",CO2unit:"g CO2e",weightUnit:"Ko",timeUnit:"sec.",privacy:"no data is collected"}},t);this.node=document.querySelector("[data-dk-badge]");this.style=e;this.pue=s;this.renderUI=i;this.labels=a;this.totalSize=0;this.timeSpent=0;this.deviceType="desktop";this.ges=0;this.updateIntervalId=null;this.events={calculated:new CustomEvent("dkBadge:calculated",{detail:this}),updated:new CustomEvent("dkBadge:updated",{detail:this})}}debug(){console.log(this)}render(){if(!this.renderUI)return;if(!this.node)return;const t=`\n\t\t\t<div class="dk-badge">\n\t\t\t\t<p class="dk-badge_title">\n\t\t\t\t\t<span>${this.labels.intro}</span>\n\t\t\t\t\t<span class="dk-badge_co2" data-dk-badge-CO2>${this.labels.unknown}</span>\n\t\t\t\t</p>\n\t\t\t\t<button class="dk-badge_button" aria-controls="dk-badge" aria-expanded="false" data-toggle-button>\n\t\t\t\t\t<svg xmlns='http://www.w3.org/2000/svg' viewBox="-2 -2 20 20" fill='none' stroke='#fff' stroke-linecap='round' stroke-width='2'>\n\t\t\t\t\t\t<path d="M-2 8h20"/>\n\t\t\t\t\t\t<path d="M-2 8h20" class="v"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class="sr-only">${this.labels.details}</span>\n\t\t\t\t</button>\n\t\t\t\t<div class="dk-badge_content" data-toggle-content id="dk-badge">\n\t\t\t\t\t<hr class="dk-badge_hr" role="presentation">\n\t\t\t\t\t<p class="dk-badge_data">${this.labels.weight}&nbsp;: <strong data-dk-badge-weight>${this.labels.unknown}</strong></p>\n\t\t\t\t\t<p class="dk-badge_data">${this.labels.time}&nbsp;: <strong data-dk-badge-time>${this.labels.unknown}</strong></p>\n\t\t\t\t\t<p class="dk-badge_data">${this.labels.device}&nbsp;: <strong data-dk-badge-device>${this.labels.unknown}</strong></p>\n\t\t\t\t\t<hr class="dk-badge_hr" role="presentation">\n\t\t\t\t\t<p class="dk-badge_data">Powered by DK <span class="is-small">${this.labels.privacy}</span></p>\n\t\t\t\t</div>\n\t\t\t</div>`;this.node.innerHTML=t}getUserDevice(){const t=navigator.userAgent.toLowerCase();const e=/iphone|android/.test(t)?"Mobile":false;const i=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(t)?"Tablet":false;return e||i||"Desktop"}getStoredData(){let t=sessionStorage.getItem("dk-badge");if(t){t=JSON.parse(t);this.timeSpent=t.timeSpent;this.totalSize=t.totalSize}}storeData(){sessionStorage.setItem("dk-badge",JSON.stringify({timeSpent:this.timeSpent,totalSize:this.totalSize}))}calculate(t,e,i){const s=t/1e3;const a={france_server_proportion:.5,international_server_proportion:.5,wifi_proportion:.5,g4_proportion:.5,mobile_proportion:i==="Mobile"?1:0,desktop_proportion:i==="Desktop"?1:0,tablette_proportion:i==="Tablet"?1:0,audience_location_france:1,audience_location_europe:0,audience_location_international:0};const n={acv:s/this.#factors.server_bandwidth*(this.#factors.server_lifecycle/1e3),usage:(a.france_server_proportion*this.#factors.france_server_efficiency*this.#factors.france_electricity_carbon_intensity+a.international_server_proportion*this.#factors.international_server_efficiency*this.#factors.world_electricity_carbon_intensity)*this.pue*(s*1e3)};const o={acv:this.#factors.network_lifecycle_impact*s,usage:s*8e3*(this.#factors.wifi_consumption*a.wifi_proportion+this.#factors.g4_consumption*a.g4_proportion)*(this.#factors.server_country_network_ratio*(a.france_server_proportion*this.#factors.france_electricity_carbon_intensity+a.international_server_proportion*this.#factors.world_electricity_carbon_intensity)+this.#factors.viewing_country_network_ratio*(a.audience_location_france*this.#factors.france_electricity_carbon_intensity+a.audience_location_europe*this.#factors.europe_electricity_carbon_intensity+a.audience_location_international*this.#factors.world_electricity_carbon_intensity))};const r={acv:e*(this.#factors.mobile_acv_emissions*a.mobile_proportion/this.#factors.mobile_lifespan+this.#factors.desktop_acv_emissions*a.desktop_proportion/this.#factors.desktop_lifespan+this.#factors.tablette_acv_emissions*a.tablette_proportion/this.#factors.tablette_lifespan),usage:e/3600*(this.#factors.mobile_power*a.mobile_proportion+this.#factors.desktop_power*a.desktop_proportion+this.#factors.tablette_power*a.tablette_proportion)*(a.audience_location_france*this.#factors.france_electricity_carbon_intensity+a.audience_location_europe*this.#factors.europe_electricity_carbon_intensity+a.audience_location_international*this.#factors.world_electricity_carbon_intensity)};const l=(n.acv+n.usage+o.acv+o.usage+r.acv+r.usage)*1e3;this.ges=l;document.dispatchEvent(this.events.calculated)}#updateElement(t,e){if(!this.renderUI)return;const i=this.node.querySelector(`[data-dk-badge-${t}]`);if(!i)return;i.innerHTML=e}update(){if(!this.renderUI)return;var t=[{key:"CO2",value:this.ges.toFixed(2)+" "+this.labels.CO2unit},{key:"time",value:this.timeSpent+" "+this.labels.timeUnit},{key:"device",value:this.deviceType},{key:"weight",value:(this.totalSize/1e3).toFixed(2)+" "+this.labels.weightUnit}];t.forEach((t=>{this.#updateElement(t.key,t.value)}));document.dispatchEvent(this.events.updated)}getResources(t=performance.getEntries()){if(!t)return;if(t.length!==0){t.forEach(((t,e)=>{if("transferSize"in t){this.totalSize=this.totalSize+t.transferSize}}))}this.calculate(this.totalSize,this.timeSpent,this.deviceType)}perfObserver(t,e,i){this.getResources(t.getEntries());if(i>0){console.warn(`${i} entries got dropped due to the buffer being full.`)}}updateInterval(){return setInterval((()=>{this.timeSpent+=1;this.storeData();if(this.timeSpent%5===0){this.getResources([])}else{this.#updateElement("time",this.timeSpent+" "+this.labels.timeUnit)}}),1e3)}handleVisibilityChange(){if(document.hidden){clearInterval(this.updateIntervalId);this.updateIntervalId=null}else{this.updateIntervalId=this.updateIntervalId||this.updateInterval()}}init(){this.render();const t=new PerformanceObserver((t=>{this.perfObserver.call(this,t)}));this.handleVisibilityChange();document.addEventListener("visibilitychange",(t=>{this.handleVisibilityChange.call(this,t)}),false);document.addEventListener("dkBadge:calculated",(t=>{this.update.call(this,t)}));setTimeout((()=>{this.deviceType=this.getUserDevice();this.getStoredData();this.getResources();t.observe({entryTypes:["resource","navigation"]})}),500)}}document.addEventListener("click",(t=>{if(t.target.closest("[data-toggle-button]")){disclosure(t.target.closest("[data-toggle-button]"))}else if(!t.target.closest("[data-toggle-wrapper]")){const t=document.querySelectorAll(`[data-toggle-button]`);const e=document.querySelectorAll(`[data-toggle-content]`);if(t){t.forEach((t=>{t.setAttribute("aria-expanded","false")}))}if(e){e.forEach((t=>{t.setAttribute("data-expanded","false")}))}}}));document.addEventListener("keydown",(t=>{const e=27;if(t.keyCode===e){disclosure(t.target,"close")}}));document.addEventListener("blur",(t=>{if(t.relatedTarget&&!t.relatedTarget.closest("[data-toggle-wrapper]")){disclosure(t.target,"close")}}),true);